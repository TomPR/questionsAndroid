<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>Question.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">debug</a> &gt; <a href="index.source.html" class="el_package">hk.ust.cse.hunkim.questionroom.question</a> &gt; <span class="el_source">Question.java</span></div><h1>Question.java</h1><pre class="source lang-java linenums">package hk.ust.cse.hunkim.questionroom.question;

import java.util.Date;

/**
 * Created by hunkim on 7/16/15.
 */
public class Question implements Comparable&lt;Question&gt; {

    /**
     * Must be synced with firebase JSON structure
     * Each must have getters
     */
    private String key;
    private String wholeMsg;
    private String head;
    private String headLastChar;
    private String desc;
    private String linkedDesc;
    private boolean completed;
    private long timestamp;
    private String tags;
    private int echo;
    private int order;
    private boolean newQuestion;

    public String getDateString() {
<span class="fc" id="L28">        return dateString;</span>
    }

    private String dateString;

    public String getTrustedDesc() {
<span class="fc" id="L34">        return trustedDesc;</span>
    }

    private String trustedDesc;

    // Required default constructor for Firebase object mapping
    @SuppressWarnings(&quot;unused&quot;)
<span class="fc" id="L41">    private Question() {</span>
<span class="fc" id="L42">    }</span>

    /**
     * Set question from a String message
     * @param message string message
     */
<span class="fc" id="L48">    public Question(String message) {</span>
<span class="fc" id="L49">        this.wholeMsg = message;</span>
<span class="fc" id="L50">        this.echo = 0;</span>
<span class="fc" id="L51">        this.head = getFirstSentence(message).trim();</span>
<span class="fc" id="L52">        this.desc = &quot;&quot;;</span>
<span class="fc bfc" id="L53" title="All 2 branches covered.">        if (this.head.length() &lt; message.length()) {</span>
<span class="fc" id="L54">            this.desc = message.substring(this.head.length());</span>
        }

        // get the last char
<span class="fc" id="L58">        this.headLastChar = head.substring(head.length() - 1);</span>

<span class="fc" id="L60">        this.timestamp = new Date().getTime();</span>
<span class="fc" id="L61">    }</span>

    /**
     * Get first sentence from a message
     * @param message
     * @return
     */
    public static String getFirstSentence(String message) {
<span class="fc" id="L69">        String[] tokens = {&quot;. &quot;, &quot;? &quot;, &quot;! &quot;};</span>

<span class="fc" id="L71">        int index = -1;</span>

<span class="fc bfc" id="L73" title="All 2 branches covered.">        for (String token : tokens) {</span>
<span class="fc" id="L74">            int i = message.indexOf(token);</span>
<span class="fc bfc" id="L75" title="All 2 branches covered.">            if (i == -1) {</span>
<span class="fc" id="L76">                continue;</span>
            }

<span class="fc bfc" id="L79" title="All 2 branches covered.">            if (index == -1) {</span>
<span class="fc" id="L80">                index = i;</span>
            } else {
<span class="fc" id="L82">                index = Math.min(i, index);</span>
            }
        }

<span class="fc bfc" id="L86" title="All 2 branches covered.">        if (index == -1) {</span>
<span class="fc" id="L87">            return message;</span>
        }

<span class="fc" id="L90">        return message.substring(0, index+1);</span>
    }

    /* -------------------- Getters ------------------- */
    public String getHead() {
<span class="fc" id="L95">        return head;</span>
    }

    public String getDesc() {
<span class="fc" id="L99">        return desc;</span>
    }

    public int getEcho() {
<span class="fc" id="L103">        return echo;</span>
    }

    public String getWholeMsg() {
<span class="fc" id="L107">        return wholeMsg;</span>
    }

    public String getHeadLastChar() {
<span class="fc" id="L111">        return headLastChar;</span>
    }

    public String getLinkedDesc() {
<span class="fc" id="L115">        return linkedDesc;</span>
    }

    public boolean isCompleted() {
<span class="fc" id="L119">        return completed;</span>
    }

    public long getTimestamp() {
<span class="fc" id="L123">        return timestamp;</span>
    }

    public String getTags() {
<span class="fc" id="L127">        return tags;</span>
    }

    public int getOrder() {
<span class="fc" id="L131">        return order;</span>
    }

    public boolean isNewQuestion() {
<span class="fc" id="L135">        return newQuestion;</span>
    }

    public void updateNewQuestion() {
<span class="pc bpc" id="L139" title="1 of 2 branches missed.">        newQuestion = this.timestamp &gt; new Date().getTime() - 180000;</span>
<span class="fc" id="L140">    }</span>

    public String getKey() {
<span class="fc" id="L143">        return key;</span>
    }

    public void setKey(String key) {
<span class="fc" id="L147">        this.key = key;</span>
<span class="fc" id="L148">    }</span>

    /**
     * New one/high echo goes bottom
     * @param other other chat
     * @return order
     */
    @Override
    public int compareTo(Question other) {
        // Push new on top
<span class="fc" id="L158">        other.updateNewQuestion(); // update NEW button</span>
<span class="fc" id="L159">        this.updateNewQuestion();</span>

<span class="pc bpc" id="L161" title="1 of 2 branches missed.">        if (this.newQuestion != other.newQuestion) {</span>
<span class="nc bnc" id="L162" title="All 2 branches missed.">            return this.newQuestion ? 1 : -1; // this is the winner</span>
        }


<span class="pc bpc" id="L166" title="1 of 2 branches missed.">        if (this.echo == other.echo) {</span>
<span class="fc bfc" id="L167" title="All 2 branches covered.">            if (other.timestamp == this.timestamp) {</span>
<span class="fc" id="L168">                return 0;</span>
            }
<span class="fc bfc" id="L170" title="All 2 branches covered.">            return other.timestamp &gt; this.timestamp ? -1 : 1;</span>
        }
<span class="nc" id="L172">        return this.echo - other.echo;</span>
    }


    @Override
    public boolean equals(Object o) {
<span class="fc bfc" id="L178" title="All 2 branches covered.">        if (!(o instanceof Question)) {</span>
<span class="fc" id="L179">            return false;</span>
        }
<span class="fc" id="L181">        Question other = (Question)o;</span>
<span class="fc" id="L182">        return key.equals(other.key);</span>
    }

    @Override
    public int hashCode() {
<span class="nc" id="L187">        return key.hashCode();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.4.201502262128</span></div></body></html>